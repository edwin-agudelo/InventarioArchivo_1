CREATE TABLE [tipo_archivo] ([tip_id] integer NOT NULL PRIMARY KEY AUTOINCREMENT, [tip_ext] nvarchar(50), [tip_desc] nvarchar(150));
CREATE TABLE [editorial] ([edi_id] integer NOT NULL PRIMARY KEY AUTOINCREMENT,[edi_nombre] nvarchar(50) NOT NULL,[edi_reg] timestamp DEFAULT CURRENT_TIMESTAMP);
CREATE UNIQUE INDEX [index_editorial_1]	ON [editorial] ([edi_nombre]);
CREATE TABLE [divisiones] ([div_id] integer NOT NULL PRIMARY KEY AUTOINCREMENT, [div_ruta] nvarchar(1000) NOT NULL, [div_nombre] nvarchar(50) NOT NULL, [div_elementos] numeric(53, 0) DEFAULT '0', [div_creado] date DEFAULT CURRENT_DATE, [div_descripcion] text, [div_estado] integer, [div_padre] integer, [div_usu_crea] integer DEFAULT 0);
CREATE TABLE [libros] ([lib_id] integer NOT NULL PRIMARY KEY AUTOINCREMENT, [lib_nombre] nvarchar(60) NOT NULL, [lib_edi_id] integer DEFAULT '0', [lib_autor] nvarchar(60), [lib_edicion] integer DEFAULT '1', [lib_anio] integer DEFAULT '2000', [lib_ruta] nvarchar(1000) NOT NULL, [lib_tamanio] float DEFAULT '0', [lib_isbn] nvarchar(50), [lib_tip_id] integer, [lib_calificacion] integer DEFAULT '1', [lib_comprimido] integer DEFAULT '0', [lib_div_id] integer NOT NULL, FOREIGN KEY ([lib_edi_id])REFERENCES [editorial] ([edi_id])ON UPDATE NO ACTION ON DELETE NO ACTION, FOREIGN KEY ([lib_div_id])REFERENCES [divisiones] ([div_id])ON UPDATE NO ACTION ON DELETE NO ACTION, FOREIGN KEY ([lib_tip_id])REFERENCES [tipo_archivo] ([tip_id])ON UPDATE NO ACTION ON DELETE NO ACTION);
CREATE TRIGGER desp_insert AFTER INSERT ON libros FOR EACH ROW BEGIN UPDATE divisiones SET div_elementos = (div_elementos + 1) WHERE div_id = (CASE WHEN NEW.lib_div_id IS NULL THEN 1  WHEN NEW.lib_div_id = 0 THEN 1 ELSE NEW.lib_div_id END); END;
CREATE TRIGGER desp_delete AFTER DELETE ON libros FOR EACH ROW BEGIN UPDATE divisiones SET div_elementos = (div_elementos - 1) WHERE div_id = (CASE WHEN OLD.lib_div_id IS NULL THEN 1 WHEN OLD.lib_div_id = 0 THEN 1 ELSE OLD.lib_div_id END);END;
CREATE TRIGGER desp_update AFTER UPDATE ON libros FOR EACH ROW BEGIN UPDATE divisiones SET div_elementos = (div_elementos - 1) WHERE div_id = (CASE WHEN OLD.lib_div_id IS NULL THEN 1 WHEN OLD.lib_div_id = 0 THEN 1 ELSE OLD.lib_div_id END);UPDATE divisiones SET div_elementos = (div_elementos + 1) WHERE div_id = (CASE WHEN NEW.lib_div_id IS NULL THEN 1 WHEN NEW.lib_div_id = 0 THEN 1 ELSE NEW.lib_div_id END);END
CREATE TABLE [comentarios] ([com_id] integer NOT NULL PRIMARY KEY AUTOINCREMENT, [com_lib_id] integer NOT NULL, [com_fecha] date DEFAULT CURRENT_DATE, [com_comentario] text, FOREIGN KEY ([com_lib_id])REFERENCES [libros] ([lib_id])ON UPDATE NO ACTION ON DELETE NO ACTION);
CREATE TABLE [recientes] ([rec_id] integer NOT NULL PRIMARY KEY AUTOINCREMENT, [rec_fecha] timestamp DEFAULT CURRENT_TIMESTAMP, [rec_lib_id] integer NOT NULL, FOREIGN KEY ([rec_lib_id])REFERENCES [libros] ([lib_id])ON UPDATE NO ACTION ON DELETE NO ACTION);
INSERT INTO [editorial]([edi_nombre]) VALUES('Por Defecto');